
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <style>
        body
        {
            background-color:#F2F2F2;
        }
        .item
        {
            width:400px;
            min-height:200px;
            padding:0 20px;
            margin:50px auto;
            background-color:#fff;
            border:1px solid #cccccc;
            box-shadow:#808080 2px 2px 2px;
            border-radius:5px;
        }
        .progressBg
        {
             margin-top:20px;
             width:100%;
             height:30px;
             border:1px solid #999999;
             border-radius:5px;
             box-shadow:#808080 1px 1px 1px;
             background-color:#CCCCCC;
        }
        .progressBar
        {
            width:50%;
            height:28px;
            border:1px solid #fff;
            border-radius:5px;
            background-color:#33CCCC;
            text-align:center;
        }
        .progressBar span
        {
            font-size:14px;
            color:#FFF;
            line-height:30px;
        }
    </style>
    <script>
        window.onload = function () {

            var btnUpload = document.getElementById('btnUpload');
            btnUpload.onclick = function () {
                var fileInput = document.getElementById('File2');
                if (!fileInput.value) { return; }

                setProgressBar('progressBar1', '0%');
                var xhr = new XMLHttpRequest();
                var formData = new FormData();
                formData.append("UserPhoto", fileInput.files[0]);
                xhr.open("post", './UploadFile_2');

                xhr.onload = function (event) {
                    alert('上传成功')
                };

                xhr.onerror = function () {
                    alert("上传失败")
                };

                xhr.upload.onprogress = function (event) {
                    if (event.lengthComputable) {
                        var pre = (100 * event.loaded / event.total);
                        pre = Math.floor(pre);
                        setProgressBar('progressBar1', pre + '%')
                    }
                };

                xhr.send(formData);
            }
        }

        function setProgressBar(id,pre) {
            var progressBar = document.getElementById('progressBar');
            progressBar.style.width = pre;

            var progressPre = progressBar.firstChild;
            if (pre == "0%") {
                pre = "";
            } 
            progressPre.innerText = pre;
        }

    </script>
</head>
<body>
    <form enctype="multipart/form-data" action="UploadFile_1" method="post">
        <div class="item">
            <h3>
                原生简单上传
            </h3>
            <input id="File1" name="UserPhoto" type="file" value="" />
            <input type="submit" value="提交上传" />
        </div>
    </form>

    <form enctype="multipart/form-data" action="./UploadFile_2" method="post">
        <div class="item">
            <h3>
                JavaScript异步上传 (使用HTML5 API)
            </h3>
            <input id="File2" name="UserPhoto" type="file" value="" />
            <input id="btnUpload" type="button" value="提交上传" />
            <div class="progressBg">
                <div id="progressBar1" class="progressBar">
                    <span>0%</span>
                </div>
            </div>
            
        </div>
        
    </form>
</body>
</html>
